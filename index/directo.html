<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="style.css">
    <title>Directo - StatisticSports</title>
</head>

<body>
    <header>
        <div id="cab">
            <h1><a href="./index.html">StatisticSports</a></h1>
            <div id="login">
                <h2>Inicio de sesion</h2>
                <form action="#" method="post">
                    <label for="Usuario">Usuario</label>
                    <input type="text" name="usu">
                    <label for="Contraseña">Contraseña</label>
                    <input type="password" name="pass">
                    <input type="submit" name="log" value="Entrar">
                </form>
                <a href="./registro.php">Registrarse</a>
                <!-- Crear formulario para registrar-->
                <a href="#">No recuerdo contraseña</a>
                <!-- Crear formulario para que mediante el correo pueda recuperar contraseña-->
            </div>
        </div>
        <nav>
            <ul class="nav">
                <li><a href="#">INICIO</a></li>
                <li><a href="#">CATEGORIAS</a>
                    <ul>
                        <li><a href="#">FEMENINO</a>
                            <ul>
                                <li><a href="">FEM1</a></li>
                                <li><a href="">FEM2</a></li>
                                <li><a href="">FEM3</a></li>
                                <li><a href="">FEM4</a></li>
                            </ul>
                        </li>
                        <li><a href="#">MASCULINO</a>
                            <ul>
                                <li><a href="">MASC1</a></li>
                                <li><a href="">MASC2</a></li>
                                <li><a href="">MASC3</a></li>
                                <li><a href="">MASC4</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><a href="#">ENCUENTROS</a></li>
                <li><a href="./directo.html">DIRECTO</a></li>
            </ul>
        </nav>
    </header>
    <hr>
    <main id="main">
        <div id="directo">
            <input type="text" name="in-p" id="in-p">
            <button id="bt-coger">COGER</button>
        </div>
        <script>
            let bt_p = document.getElementById("bt-coger")
            bt_p.addEventListener('click', recogerPersona)

            function recogerPersona() {
                let persona = document.getElementById("in-p").value

                // Recogemos persona pedido por input
                let req
                if (window.XMLHttpRequest) {
                    req = new XMLHttpRequest();
                } else if (window.ActiveXObject) {
                    req = ActiveXObject("Microsoft.XMLHTTP");
                }
                req.onreadystatechange = function () {
                    if (req.readyState == 4) {
                        if (req.status == 200) {
                            let id = req.responseText
                            let datos = id.split(",")
                            // Si la persona introducida existe creara la ficha sino te pedira otra vez datos
                            if (datos[0] != "") {
                                crearFicha(datos)
                            } else {
                                alert("No has seleccionado a nadie.")
                            }
                        }
                    }
                }
                req.open("GET", "basedatos.php?p=" + persona + "&bt=bla");
                req.send()
            }

            function crearFicha(datos) {
                let doc = document.getElementById('main')
                doc.innerHTML = ''

                let ficha = document.createElement("div")
                ficha.setAttribute("id", "d-ficha")

                let d1 = document.createElement("p")
                d1.innerHTML = "ID_JUGADOR: " + datos[0]
                let d2 = document.createElement("p")
                d2.innerHTML = "NOMBRE: " + datos[1]
                let d3 = document.createElement("p")
                d3.innerHTML = "ID_EQUIPO: " + datos[2]
                let d4 = document.createElement("p")
                d4.innerHTML = "PUESTO: " + datos[3]
                let p = document.createElement("p")
                p.setAttribute('class', "p-adv")
                p.innerHTML = "Pulsa 'ESPACIO' para escribir datos."

                ficha.appendChild(d1)
                ficha.appendChild(d2)
                ficha.appendChild(d3)
                ficha.appendChild(d4)
                ficha.appendChild(p)
                doc.appendChild(ficha)

                window.onkeydown = function (e) {
                    if (e.keyCode == 32) {
                        console.log("Has presionado espacio")
                        cRec(datos, doc)
                    }
                }
            }

            function cRec(datos) {
                let doc = document.body
                let div = document.createElement("div")
                    div.setAttribute('id', "d-valores")
                let p1 = document.createElement("p")
                    p1.innerHTML = "Introduce tipo de accion:"
                let in1 = document.createElement("input")
                    in1.setAttribute('type', "text")
                    in1.setAttribute("name", "v2")
                    in1.setAttribute("id", "i-v2")
                let p2 = document.createElement("p")
                    p2.innerHTML = "Introduce valor de la accion:"
                let in2 = document.createElement("input")
                    in2.setAttribute('type', "text")
                    in2.setAttribute("name", "v3")
                    in2.setAttribute("id", "i-v3")
                let p = document.createElement("p")
                p.setAttribute('class', "p-adv")
                p.innerHTML = "Pulsa 'ENTER' para enviar datos."

                div.appendChild(p1)
                div.appendChild(in1)
                div.appendChild(p2)
                div.appendChild(in2)
                div.appendChild(p)
                doc.insertBefore(div,document.body.firstChild)
                in1.focus()

                window.onkeydown = function (e) {
                    if (e.keyCode == 13) {
                        console.log("Has presionado enter")
                        let v2 = in1.value.trim().toUpperCase()
                        let v3 = in2.value.trim()
                        darValor(datos, v2, v3)
                        doc.removeChild(div)
                        crearFicha(datos)
                    }
                }
            }
            function darValor(datos, v2, v3) {
                let array = [datos[1], v2, v3]
                var req
                if (window.XMLHttpRequest) {
                    req = new XMLHttpRequest();
                } else if (window.ActiveXObject) {
                    req = ActiveXObject("Microsoft.XMLHTTP");
                }
                req.onreadystatechange = function () {
                    if (req.readyState == 4) {
                        if (req.status == 200) {
                            console.log("DATOS MANDADOS CON ÉXITO")
                        }
                    }
                }
                req.open("GET", "basedatos.php?array=" + JSON.stringify(array));
                req.send()
            }
        </script>
    </main>
    <hr>
    <footer>
        <p>Web creada por Bea, Alexandru y Marta</p>
    </footer>
</body>

</html>